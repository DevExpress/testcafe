{"version":3,"sources":["upload/form-data-entry.js"],"names":[],"mappings":"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","file":"upload/form-data-entry.js","sourcesContent":["import * as bufferUtils from '../utils/buffer';\r\n\r\n// Const\r\nconst INPUT_NAME_RE = /;\\s*name=\"([^\"]*)\"/i;\r\nconst FILE_NAME_RE  = /;\\s*filename=\"([^\"]*)\"/i;\r\nconst HEADER_RE     = /^(.+?):\\s*(.*)$/;\r\n\r\n\r\n// FormDataEntry\r\nexport default class FormDataEntry {\r\n    constructor () {\r\n        this.body     = [];\r\n        this.headers  = {};\r\n        this.name     = null;\r\n        this.fileName = null;\r\n    }\r\n\r\n    _parseContentDisposition (contentDisposition) {\r\n        var inputNameMatch = contentDisposition.match(INPUT_NAME_RE);\r\n        var fileNameMatch  = contentDisposition.match(FILE_NAME_RE);\r\n\r\n        this.name     = inputNameMatch && inputNameMatch[1];\r\n        this.fileName = fileNameMatch && fileNameMatch[1];\r\n    }\r\n\r\n    _setContentDisposition (name, fileName) {\r\n        this.name     = name;\r\n        this.fileName = fileName;\r\n\r\n        this.headers['Content-Disposition'] = `form-data; name=\"${name}\"; filename=\"${fileName}\"`;\r\n    }\r\n\r\n    // API\r\n    addFileInfo (fileInfo, idx) {\r\n        var file = fileInfo.files[idx];\r\n\r\n        this._setContentDisposition(fileInfo.name, file.name);\r\n\r\n        this.body                    = [new Buffer(file.data, 'base64')];\r\n        this.headers['Content-Type'] = file.type;\r\n    }\r\n\r\n    setHeader (header, newValue) {\r\n        var headerMatch = header.match(HEADER_RE);\r\n        var name        = headerMatch[1];\r\n        var value       = newValue || headerMatch [2];\r\n\r\n        this.headers[name] = value;\r\n\r\n        if (name === 'Content-Disposition')\r\n            this._parseContentDisposition(value);\r\n    }\r\n\r\n    toBuffer () {\r\n        var chunks = [];\r\n\r\n        Object.keys(this.headers).forEach((name) => {\r\n            var value = this.headers[name];\r\n\r\n            chunks.push(new Buffer(`${name}: ${value}`));\r\n            chunks.push(bufferUtils.CRLF);\r\n        });\r\n\r\n        chunks.push(bufferUtils.CRLF);\r\n        chunks     = chunks.concat(this.body);\r\n\r\n        return Buffer.concat(chunks);\r\n    }\r\n}"],"sourceRoot":"../src"}