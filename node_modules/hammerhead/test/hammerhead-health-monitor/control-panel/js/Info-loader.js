var RESPONSE_STATUS_ERROR_TEXT = 'Response from server with status ';

function InfoLoader () {
    this._lock   = null;
    this._unlock = null;
}

InfoLoader.prototype._setOnLock = function (handler) {
    this._lock = function () {
        this._isLock = true;
        handler();
    };
};

InfoLoader.prototype._setOnUnlock = function (handler) {
    this._unlock = function () {
        this._isLock = false;
        handler();
    };
};

InfoLoader.prototype._sendMsg = function (action, text, success, error) {
    var xhr    = new XMLHttpRequest();
    var loader = this;

    this._lock();

    xhr.open("POST", "/xhr/" + action, true);
    xhr.addEventListener('readystatechange', function () {
        if (xhr.readyState === xhr.DONE) {
            if (xhr.status === 200) {
                try {
                    setTimeout(function () {
                        success(JSON.parse(xhr.responseText));
                    }, 0);
                } catch (e) {
                    error(e);
                }
            } else
                error(RESPONSE_STATUS_ERROR_TEXT + xhr.status);

            loader._unlock();
        }
    });
    xhr.send(text);
};
