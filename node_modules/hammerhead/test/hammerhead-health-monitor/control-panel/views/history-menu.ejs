<%
    if (result) {
        var currentTimestamp = result.timestamp,
            index = 0,
            currentTimeZone = (new Date()).getTimezoneOffset(),
            hasBuildInfo = result.buildInfo instanceof Array && result.buildInfo.length;

        function getStringTime(timestamp, timeZone) {
            var difTimeZone = -60 * timeZone - currentTimeZone,
                date = new Date(timestamp - difTimeZone * 60000);

            return [
                ["January", "February", "March", "April", "May", "June", "July",
                 "August", "September", "October", "November", "December"][date.getMonth()],
                ('0' + date.getDate()).substr(-2, 2),
                [
                    ('0' + date.getHours()).substr(-2, 2),
                    ('0' + date.getMinutes()).substr(-2, 2),
                    ('0' + date.getSeconds()).substr(-2, 2)
                ].join(':')
            ].join(' ');
        }

        function hasInfinityPageLoad(errors) {
            for (var i = 0; i < errors.length; i++) {
                if (errors[i].text === 'Infinite page load')
                    return true;
            }

            return false;
        }

        function getUrlOptionClass(errors) {
            if (errors.length) {
                if (hasInfinityPageLoad(errors))
                    return 'with-infinity-page-load';
                else
                    return 'with-error';
            }

            return '';
        }
%>
    <script src="/control-panel/js/history-menu.js"></script>
    <ul class="sub-menu">
        <li class="timestamps">
            <select>
                <% for (var i = 0; i < runList.length; i++) { %>
                    <option
                        value="<%= ('?timestamp=' + runList[i].timestamp + '&url=' + result.data[currentSiteIndex].url) %>"
                        <%= (currentTimestamp === runList[i].timestamp ? ' selected' : '') %>
                        ><%= getStringTime(runList[i].timestamp, 4) %></option>
                <% } %>
            </select>
        </li>
        <li class="results">
            <select>
                <% for (var i = 0; i < result.data.length; i++) { %>
                    <option
                        value="<%= ('?timestamp=' + currentTimestamp + '&result=' + i) %>"
                        <%= (i === currentSiteIndex ? ' selected' : '') %>
                        class="<%- getUrlOptionClass(result.data[i].console) %>"
                        ><%= result.data[i].url %></option>
                <% } %>
            </select>
        </li>
        <li class="build-info<%= (hasBuildInfo ? '' : ' disable') %>">View build info</li>
    </ul>
    <script src="/control-panel/vendor/jquery-ui.js"></script>
    <div id="dialog">
        <%
            if (hasBuildInfo) {
                var buildInfo = result.buildInfo;
        %>
            <ul class="list-table build-info">
                <li class="list-table-row headers show-all">
                    <div class="list-table-cell version">
                        <div class="wrapper"><b>Version</b></div>
                    </div>
                    <div class="list-table-cell username">
                        <div class="wrapper"><b>User name</b></div>
                    </div>
                    <div class="list-table-cell comment">
                        <div class="wrapper"><b>Comment</b></div>
                    </div>
                    <div class="list-table-cell modifiedtime">
                        <div class="wrapper"><b>Modified time</b></div>
                    </div>
                </li>
                <% if (buildInfo.length) { %>
                    <% for (var j = 0; j < buildInfo.length; j++) { %>
                        <li class="list-table-row show-all">
                            <div class="list-table-cell version">
                                <div class="wrapper"><%= buildInfo[j].version %></div>
                            </div>
                            <div class="list-table-cell username">
                                <div class="wrapper"><%= buildInfo[j].userName %></div>
                            </div>
                            <div class="list-table-cell comment">
                                <div class="wrapper"><%= buildInfo[j].comment %></div>
                            </div>
                            <div class="list-table-cell modifiedtime">
                                <div class="wrapper"><%= getStringTime(buildInfo[j].modifiedTime, 4) %></div>
                            </div>
                        </li>
                    <% } %>
                <% } %>
            </ul>
        <% } %>
    </div>
<% } %>
