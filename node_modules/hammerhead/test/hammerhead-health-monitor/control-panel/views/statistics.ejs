<%
    var loadData = [],
        minLoad = Infinity,
        minDomLoad = Infinity;

    for (var i = 0; i < data.length; i++) {
        var statData = data[i],
            statChartData = {
                arg: i,
                timestamp: statData.timestamp,
                load: statData.timing.load,
                domLoad: statData.timing.domLoad,
                document: statData.timing.document,
                script: statData.timing.script,
                stylesheet: statData.timing.stylesheet,
                withErrors: statData.sitesWithErrors,
                withoutErrors: statData.sitesWithoutErrors
            };

        if (statData.timingForFirstRun) {
            statChartData.load_fr = statData.timingForFirstRun.load;
            statChartData.domLoad_fr = statData.timingForFirstRun.domLoad;
            statChartData.document_fr = statData.timingForFirstRun.document;
            statChartData.script_fr = statData.timingForFirstRun.script;
            statChartData.stylesheet_fr = statData.timingForFirstRun.stylesheet;
        }

        loadData.push(statChartData);

        if (minLoad > data[i].timing.load)
            minLoad = data[i].timing.load;

        if (minDomLoad > data[i].timing.domLoad)
            minDomLoad = data[i].timing.domLoad;
    }
%>

<div id="statistics">
    <div class="zoomedChart" data-bind="dxChart: chartOptions" style="height: 800px; margin: 0 0 15px"></div>
    <div data-bind="dxRangeSelector: rangeOptions" style="height: 80px"></div>
</div>

<script type="text/javascript">
    var dataSource = <%- JSON.stringify(loadData) %>,
        limitLoad = <%- (minLoad + minLoad * .2) %>,
        limitDomLoad = <%- (minDomLoad + minDomLoad * .2) %>;
</script>

<script src="/control-panel/js/statistics.js"></script>