<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>gh-8054</title>
</head>
<body>
<h1>Service worker</h1>
<button>click me</button>
<script>
    const registerServiceWorker = async () => {
        if ("serviceWorker" in navigator) {
            try {
                const serviceWorkerUrl = '/fixtures/regression/gh-8054/pages/sw.js';

                const registration = await navigator.serviceWorker.register(serviceWorkerUrl, {
                    scope: "/fixtures/regression/gh-8054/pages/",
                });
                if (registration.installing) {
                    console.log("Service worker installing");
                } else if (registration.waiting) {
                    console.log("Service worker installed");
                } else if (registration.active) {
                    console.log("Service worker active");
                }
            } catch (error) {
                console.error(`Registration failed with ${error}`);
            }

            navigator.serviceWorker.addEventListener('message',
                (event) => {
                    if (event.data && event.data.result === 'success') {
                        document.querySelector('h1').innerHTML = 'Success';
                    }
                });
        }
    };

    registerServiceWorker();

    document.querySelector('button').addEventListener('click', () => {
        fetch('/?test' + Date.now());
    });
</script>
</body>
</html>
